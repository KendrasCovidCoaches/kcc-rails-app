{"ast":null,"code":"function _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport moment from 'moment';\nimport flatpickr from 'flatpickr';\nvar dateOpts = {\n  altInput: true,\n  altFormat: 'F j, Y',\n  dateFormat: 'Y-m-d',\n  minDate: new Date()\n};\nvar timeOpts = {\n  enableTime: true,\n  noCalendar: true,\n  dateFormat: \"H:i\",\n  defaultHour: 10,\n  defaultMinute: 0,\n  minuteIncrement: 10\n};\nvar OfficeHourForm = {\n  initialize: function initialize() {\n    $(document).on('turbolinks:load', function () {\n      if ($('.office-hour-form').length > 0) {\n        $('body').on('click', '.add-office-hour-slot', function (e) {\n          OfficeHourForm.addOfficeHourSlot(e);\n        });\n        $('body').on('click', '.delete-oh-slot', function (e) {\n          OfficeHourForm.deleteOfficeHourSlot(e, this);\n        });\n        $('body').on('click', '.remove-office-hour-slot', function (e) {\n          OfficeHourForm.removeOfficeHourSlot(e, this);\n        });\n        $('body').on('click', '.create-office-hour-slots', function (e) {\n          OfficeHourForm.createOfficeHourSlots(e);\n        });\n        $('body').on('click', '.cancel-office-hour-slots', function (e) {\n          window.location = '/office_hours';\n        });\n        $('body').on('click', '.oh-edit-action', function (e) {\n          OfficeHourForm.showOHAction(e, this);\n        });\n        OfficeHourForm.setupFlatpickr();\n      }\n    }).on('turbolinks:before-cache', function () {\n      if ($('.office-hour-form').length > 0) {\n        OfficeHourForm.removeFlatpickr();\n      }\n    });\n  },\n  addOfficeHourSlot: function addOfficeHourSlot(e) {\n    e.preventDefault();\n    OfficeHourForm.removeFlatpickr();\n    var slotForm = $('.office-hour-form-template').first().clone();\n    $(slotForm).find('.office-hour-date').val('');\n    $(slotForm).find('.office-hour-time').val('');\n    $(slotForm).find('.office-hour-slot-errors').text('');\n    $(slotForm).find('.remove-office-hour-slot').removeClass('hidden');\n    $(slotForm).addClass('mt-6');\n    $('.office-hour-form').append(slotForm);\n    OfficeHourForm.setupFlatpickr(); // Try to be smart about picking the next time.\n\n    OfficeHourForm.guessNextSlot();\n    return false;\n  },\n  guessNextSlot: function guessNextSlot() {\n    var allSlotForms = $('.office-hour-form-template').toArray();\n    var newSlotForm = allSlotForms.pop();\n    var lastSlotForm = allSlotForms.pop();\n    var length = $(newSlotForm).find('.office-hour-length').val();\n    var lastSlotDates = OfficeHourForm.slotStartAndEndDate(lastSlotForm);\n\n    if (!lastSlotDates) {\n      return;\n    }\n\n    var newStartDate = lastSlotDates[1];\n    var newEndDate = OfficeHourForm.addLengthToDate(length, newStartDate);\n\n    var dateObj = $(newSlotForm).find('.office-hour-date:hidden').last()[0]._flatpickr;\n\n    dateObj.setDate(newStartDate);\n\n    var timeObj = $(newSlotForm).find('.office-hour-time').last()[0]._flatpickr;\n\n    timeObj.setDate(newStartDate);\n  },\n  deleteOfficeHourSlot: function deleteOfficeHourSlot(e, that) {\n    var OHId = $(that).attr('x-id');\n    var when = $(that).attr('x-when');\n\n    var deleteCallback = function deleteCallback() {\n      $.ajax({\n        url: \"/office_hours/\".concat(OHId),\n        type: 'DELETE'\n      });\n    };\n\n    var modalActions = [{\n      type: 'danger',\n      text: I18n.t('delete_slot'),\n      callback: deleteCallback\n    }, {\n      type: 'cancel'\n    }];\n    var headerHTML = I18n.t('delete_when_office_hour', {\n      when: when\n    });\n    var bodyHTML = I18n.t('are_you_sure_you_want_to_delete_office_hour', {\n      when: when\n    });\n    Covid.showModal(headerHTML, bodyHTML, modalActions, 'warning');\n  },\n  removeOfficeHourSlot: function removeOfficeHourSlot(e, that) {\n    $(that).parents('.office-hour-form-template').remove();\n  },\n  removeFlatpickr: function removeFlatpickr() {\n    $('.office-hour-date').each(function () {\n      var parent = $(this).parent();\n      var date = $(this).val();\n      flatpickr(this).destroy();\n      $(parent).find('.office-hour-date').val(date);\n    });\n    $('.office-hour-time').each(function () {\n      var parent = $(this).parent();\n      var time = $(this).val();\n      flatpickr(this).destroy();\n      $(parent).find('.office-hour-time').val(time);\n    });\n  },\n  setupFlatpickr: function setupFlatpickr() {\n    $('.office-hour-date').each(function () {\n      var date = $(this).val();\n      var dateObj = flatpickr(this, dateOpts);\n      dateObj.setDate(date, dateOpts.dateFormat);\n    });\n    $('.office-hour-time').each(function () {\n      var time = $(this).val();\n      var timeObj = flatpickr(this, timeOpts);\n      timeObj.setDate(time, timeOpts.dateFormat);\n    });\n  },\n  createOfficeHourSlots: function createOfficeHourSlots(e) {\n    e.preventDefault();\n    $('.office-hour-slot-errors').text('');\n    $('.office-hour-description-error').text('').hide();\n    var description = $('#description').val();\n\n    if (!description) {\n      $('.office-hour-description-error').text(I18n.t('we_re_sorry_can_you_please_add_a_description_oh')).show();\n      return;\n    }\n\n    if (description.length > 160) {\n      $('.office-hour-description-error').text(I18n.t('we_re_sorry_you_can_enter_a_maximum_of_160_char')).show();\n      return;\n    }\n\n    var slots = $('.office-hour-form-template');\n    var allDates = [];\n\n    var _iterator = _createForOfIteratorHelper(slots),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var slot = _step.value;\n        var dates = OfficeHourForm.slotStartAndEndDate(slot);\n\n        if (!dates) {\n          $(slot).find('.office-hour-slot-errors').text(I18n.t('please_enter_a_date_and_a_time'));\n          continue;\n        }\n\n        if (moment().isAfter(dates[0])) {\n          $(slot).find('.office-hour-slot-errors').text(I18n.t('oops_it_seems_like_this_slot_is_in_the_past'));\n          continue;\n        }\n\n        allDates = [].concat(allDates, dates);\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n\n    if (allDates.length == 0) {\n      $('.office-hour-slot-errors').first().text(I18n.t('please_enter_at_least_one_slot'));\n      return false;\n    }\n\n    if (OfficeHourForm.doDatesOverlap(allDates)) {\n      $('.office-hour-slot-errors').first().text(I18n.t('we_re_sorry_it_seems_like_the_dates_overlap'));\n      return false;\n    }\n\n    $.post('/office_hours', {\n      office_hour_dates: allDates,\n      description: description\n    });\n    return false;\n  },\n  slotStartAndEndDate: function slotStartAndEndDate(slotForm) {\n    var dates = [];\n    var date = $(slotForm).find('.office-hour-date').val();\n    var time = $(slotForm).find('.office-hour-time').val();\n    var length = $(slotForm).find('.office-hour-length').val();\n\n    if (!date || !time || !length) {\n      return null;\n    }\n\n    var parsedStartDate = flatpickr.parseDate(\"\".concat(date, \" \").concat(time), \"\".concat(dateOpts.dateFormat, \" \").concat(timeOpts.dateFormat));\n    dates.push(parsedStartDate);\n    var parsedEndDate = OfficeHourForm.addLengthToDate(length, parsedStartDate);\n    dates.push(parsedEndDate);\n    return dates;\n  },\n  addLengthToDate: function addLengthToDate(length, date) {\n    var parsedEndDate = null;\n\n    if (length == '10m') {\n      parsedEndDate = moment(date).add(10, 'minutes').toDate();\n    } else if (length == '20m') {\n      parsedEndDate = moment(date).add(20, 'minutes').toDate();\n    } else if (length == '30m') {\n      parsedEndDate = moment(date).add(30, 'minutes').toDate();\n    }\n\n    return parsedEndDate;\n  },\n  doDatesOverlap: function doDatesOverlap(dates) {\n    if (dates.length % 2 !== 0) {\n      return true;\n    }\n\n    for (var i = 0; i < dates.length - 2; i += 2) {\n      for (var j = i + 2; j < dates.length; j += 2) {\n        if (OfficeHourForm.dateRangeOverlaps(dates[i], dates[i + 1], dates[j], dates[j + 1])) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  },\n  dateRangeOverlaps: function dateRangeOverlaps(a_start, a_end, b_start, b_end) {\n    if (a_start < b_start && b_start < a_end) return true; // b starts in a\n\n    if (a_start < b_end && b_end < a_end) return true; // b ends in a\n\n    if (b_start < a_start && a_end < b_end) return true; // a in b\n\n    return false;\n  },\n  showOHAction: function showOHAction(e, that) {\n    var participant = JSON.parse($(that).attr('x-participant'));\n\n    if (participant && participant.name) {\n      OfficeHourForm.showOHParticipant(that);\n    } else {\n      OfficeHourForm.showOHVolunteers(that);\n    }\n  },\n  showOHParticipant: function showOHParticipant(that) {\n    var OHId = $(that).attr('x-id');\n    var when = $(that).attr('x-when');\n    var participant = JSON.parse($(that).attr('x-participant'));\n    var headerHTML = I18n.t('when_office_hour', {\n      when: when\n    });\n    var bodyHTML = I18n.t('you_have_accepted_oh', {\n      participant_name: participant.name,\n      participant_email: participant.email\n    });\n    Covid.showModal(headerHTML, bodyHTML, [{\n      type: 'cancel',\n      text: 'Close'\n    }], 'warning');\n  },\n  showOHVolunteers: function showOHVolunteers(that) {\n    var OHId = $(that).attr('x-id');\n    var when = $(that).attr('x-when');\n    var volunteers = JSON.parse($(that).attr('x-volunteers'));\n\n    var acceptCallback = function acceptCallback() {\n      var acceptedUserId = $('input[name=\"applicant_id\"]:checked').val();\n\n      if (!acceptedUserId) {\n        alert(I18n.t('please_choose_an_applicant'));\n        return;\n      }\n\n      $.ajax({\n        url: \"/office_hours/\".concat(OHId, \"/accept?accepted_user_id=\").concat(acceptedUserId),\n        type: 'POST'\n      });\n    };\n\n    var deleteCallback = function deleteCallback() {\n      $.ajax({\n        url: \"/office_hours/\".concat(OHId),\n        type: 'DELETE'\n      });\n    };\n\n    var modalActions = [{\n      type: 'danger',\n      text: I18n.t('delete_slot'),\n      callback: deleteCallback\n    }, {\n      type: 'cancel'\n    }];\n    var volunteerHTML = '';\n\n    if (volunteers.length > 0) {\n      volunteerHTML += I18n.t('below_are_the_people_that_applied_for_this_slot');\n\n      var _iterator2 = _createForOfIteratorHelper(volunteers),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var volunteer = _step2.value;\n          var projectsHTML = '';\n\n          var _iterator3 = _createForOfIteratorHelper(volunteer.projects),\n              _step3;\n\n          try {\n            for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n              var project = _step3.value;\n              projectsHTML += \"\\n            <div class=\\\"sm:flex sm:justify-between\\\">\\n              <div class=\\\"ml-7 flex items-center text-sm leading-5 text-gray-500\\\">\\n                -&nbsp;&nbsp;<a href=\\\"/projects/\".concat(project.id, \"\\\" target=\\\"_blank\\\" class=\\\"hover:underline\\\">\").concat(project.name, \"</a>\\n              </div>\\n            </div>\");\n            }\n          } catch (err) {\n            _iterator3.e(err);\n          } finally {\n            _iterator3.f();\n          }\n\n          volunteerHTML += \"\\n          <ul class=\\\"mt-2\\\">\\n            <li>\\n              <div class=\\\"mb-2\\\">\\n                <div class=\\\"flex items-center justify-between\\\">\\n                  <div class=\\\"text-sm leading-5 font-medium text-primary-600 truncate\\\">\\n                    <input name=\\\"applicant_id\\\" value=\\\"\".concat(volunteer.id, \"\\\" type=\\\"radio\\\" class=\\\"form-radio inline-block mr-2 h-4 w-4 text-primary-600 transition duration-150 ease-in-out\\\" />\\n                    <a href=\\\"/users/\").concat(volunteer.id, \"\\\" target=\\\"_blank\\\" class=\\\"hover:underline\\\">\\n                      \").concat(volunteer.name, \"\\n                    </a>\\n                  </div>\\n                </div>\\n                \").concat(projectsHTML, \"\\n              </div>\\n            </li>\\n          </ul>\\n\\n          <div class=\\\"mt-2\\\">\\n            \").concat(I18n.t('once_you_accept_someone_you_ll_both_receive_a_call'), \"\\n          </div>\\n        \");\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n\n      modalActions.push({\n        type: 'submit',\n        text: I18n.t('accept'),\n        callback: acceptCallback\n      });\n    } else {\n      volunteerHTML = I18n.t('nobody_has_applied_yet');\n    }\n\n    var headerHTML = I18n.t('when_office_hour', {\n      when: when\n    });\n    var bodyHTML = \"\\n      \".concat(I18n.t(you_have_a_slot_at_when, {\n      when: when\n    }), \"\\n      <br>\\n      <br>\\n      \").concat(volunteerHTML, \"\\n    \");\n    Covid.showModal(headerHTML, bodyHTML, modalActions, 'warning');\n  }\n};\nexport default OfficeHourForm;","map":{"version":3,"sources":["/Users/a_norton/Documents/Community_Connections/covid-volunteers/app/frontend/covid/office_hour_form.js"],"names":["moment","flatpickr","dateOpts","altInput","altFormat","dateFormat","minDate","Date","timeOpts","enableTime","noCalendar","defaultHour","defaultMinute","minuteIncrement","OfficeHourForm","initialize","$","document","on","length","e","addOfficeHourSlot","deleteOfficeHourSlot","removeOfficeHourSlot","createOfficeHourSlots","window","location","showOHAction","setupFlatpickr","removeFlatpickr","preventDefault","slotForm","first","clone","find","val","text","removeClass","addClass","append","guessNextSlot","allSlotForms","toArray","newSlotForm","pop","lastSlotForm","lastSlotDates","slotStartAndEndDate","newStartDate","newEndDate","addLengthToDate","dateObj","last","_flatpickr","setDate","timeObj","that","OHId","attr","when","deleteCallback","ajax","url","type","modalActions","I18n","t","callback","headerHTML","bodyHTML","Covid","showModal","parents","remove","each","parent","date","destroy","time","hide","description","show","slots","allDates","slot","dates","isAfter","concat","doDatesOverlap","post","office_hour_dates","parsedStartDate","parseDate","push","parsedEndDate","add","toDate","i","j","dateRangeOverlaps","a_start","a_end","b_start","b_end","participant","JSON","parse","name","showOHParticipant","showOHVolunteers","participant_name","participant_email","email","volunteers","acceptCallback","acceptedUserId","alert","volunteerHTML","volunteer","projectsHTML","projects","project","id","you_have_a_slot_at_when"],"mappings":";;;;;;AAAA,OAAOA,MAAP,MAAmB,QAAnB;AACA,OAAOC,SAAP,MAAsB,WAAtB;AAEA,IAAMC,QAAQ,GAAG;AACfC,EAAAA,QAAQ,EAAE,IADK;AAEfC,EAAAA,SAAS,EAAE,QAFI;AAGfC,EAAAA,UAAU,EAAE,OAHG;AAIfC,EAAAA,OAAO,EAAE,IAAIC,IAAJ;AAJM,CAAjB;AAOA,IAAMC,QAAQ,GAAG;AACfC,EAAAA,UAAU,EAAE,IADG;AAEfC,EAAAA,UAAU,EAAE,IAFG;AAGfL,EAAAA,UAAU,EAAE,KAHG;AAIfM,EAAAA,WAAW,EAAE,EAJE;AAKfC,EAAAA,aAAa,EAAE,CALA;AAMfC,EAAAA,eAAe,EAAE;AANF,CAAjB;AASA,IAAMC,cAAc,GAAG;AACrBC,EAAAA,UADqB,wBACR;AACXC,IAAAA,CAAC,CAACC,QAAD,CAAD,CAAYC,EAAZ,CAAe,iBAAf,EAAkC,YAAM;AACtC,UAAIF,CAAC,CAAC,mBAAD,CAAD,CAAuBG,MAAvB,GAAgC,CAApC,EAAuC;AACrCH,QAAAA,CAAC,CAAC,MAAD,CAAD,CAAUE,EAAV,CAAa,OAAb,EAAsB,uBAAtB,EAA+C,UAAUE,CAAV,EAAa;AAC1DN,UAAAA,cAAc,CAACO,iBAAf,CAAiCD,CAAjC;AACD,SAFD;AAIAJ,QAAAA,CAAC,CAAC,MAAD,CAAD,CAAUE,EAAV,CAAa,OAAb,EAAsB,iBAAtB,EAAyC,UAAUE,CAAV,EAAa;AACpDN,UAAAA,cAAc,CAACQ,oBAAf,CAAoCF,CAApC,EAAuC,IAAvC;AACD,SAFD;AAIAJ,QAAAA,CAAC,CAAC,MAAD,CAAD,CAAUE,EAAV,CAAa,OAAb,EAAsB,0BAAtB,EAAkD,UAAUE,CAAV,EAAa;AAC7DN,UAAAA,cAAc,CAACS,oBAAf,CAAoCH,CAApC,EAAuC,IAAvC;AACD,SAFD;AAIAJ,QAAAA,CAAC,CAAC,MAAD,CAAD,CAAUE,EAAV,CAAa,OAAb,EAAsB,2BAAtB,EAAmD,UAAUE,CAAV,EAAa;AAC9DN,UAAAA,cAAc,CAACU,qBAAf,CAAqCJ,CAArC;AACD,SAFD;AAIAJ,QAAAA,CAAC,CAAC,MAAD,CAAD,CAAUE,EAAV,CAAa,OAAb,EAAsB,2BAAtB,EAAmD,UAAUE,CAAV,EAAa;AAC9DK,UAAAA,MAAM,CAACC,QAAP,GAAkB,eAAlB;AACD,SAFD;AAIAV,QAAAA,CAAC,CAAC,MAAD,CAAD,CAAUE,EAAV,CAAa,OAAb,EAAsB,iBAAtB,EAAyC,UAAUE,CAAV,EAAa;AACpDN,UAAAA,cAAc,CAACa,YAAf,CAA4BP,CAA5B,EAA+B,IAA/B;AACD,SAFD;AAIAN,QAAAA,cAAc,CAACc,cAAf;AACD;AAEF,KA7BD,EA6BGV,EA7BH,CA6BM,yBA7BN,EA6BiC,YAAY;AAC3C,UAAIF,CAAC,CAAC,mBAAD,CAAD,CAAuBG,MAAvB,GAAgC,CAApC,EAAuC;AACrCL,QAAAA,cAAc,CAACe,eAAf;AACD;AACF,KAjCD;AAkCD,GApCoB;AAsCrBR,EAAAA,iBAtCqB,6BAsCHD,CAtCG,EAsCA;AACnBA,IAAAA,CAAC,CAACU,cAAF;AAEAhB,IAAAA,cAAc,CAACe,eAAf;AAEA,QAAME,QAAQ,GAAGf,CAAC,CAAC,4BAAD,CAAD,CAAgCgB,KAAhC,GAAwCC,KAAxC,EAAjB;AAEAjB,IAAAA,CAAC,CAACe,QAAD,CAAD,CAAYG,IAAZ,CAAiB,mBAAjB,EAAsCC,GAAtC,CAA0C,EAA1C;AACAnB,IAAAA,CAAC,CAACe,QAAD,CAAD,CAAYG,IAAZ,CAAiB,mBAAjB,EAAsCC,GAAtC,CAA0C,EAA1C;AACAnB,IAAAA,CAAC,CAACe,QAAD,CAAD,CAAYG,IAAZ,CAAiB,0BAAjB,EAA6CE,IAA7C,CAAkD,EAAlD;AACApB,IAAAA,CAAC,CAACe,QAAD,CAAD,CAAYG,IAAZ,CAAiB,0BAAjB,EAA6CG,WAA7C,CAAyD,QAAzD;AAEArB,IAAAA,CAAC,CAACe,QAAD,CAAD,CAAYO,QAAZ,CAAqB,MAArB;AACAtB,IAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuBuB,MAAvB,CAA8BR,QAA9B;AAEAjB,IAAAA,cAAc,CAACc,cAAf,GAfmB,CAiBnB;;AACAd,IAAAA,cAAc,CAAC0B,aAAf;AAEA,WAAO,KAAP;AACD,GA3DoB;AA6DrBA,EAAAA,aA7DqB,2BA6DL;AACd,QAAMC,YAAY,GAAGzB,CAAC,CAAC,4BAAD,CAAD,CAAgC0B,OAAhC,EAArB;AACA,QAAMC,WAAW,GAAGF,YAAY,CAACG,GAAb,EAApB;AACA,QAAMC,YAAY,GAAGJ,YAAY,CAACG,GAAb,EAArB;AAEA,QAAMzB,MAAM,GAAGH,CAAC,CAAC2B,WAAD,CAAD,CAAeT,IAAf,CAAoB,qBAApB,EAA2CC,GAA3C,EAAf;AAEA,QAAMW,aAAa,GAAGhC,cAAc,CAACiC,mBAAf,CAAmCF,YAAnC,CAAtB;;AACA,QAAI,CAACC,aAAL,EAAoB;AAClB;AACD;;AAED,QAAIE,YAAY,GAAGF,aAAa,CAAC,CAAD,CAAhC;AACA,QAAIG,UAAU,GAAGnC,cAAc,CAACoC,eAAf,CAA+B/B,MAA/B,EAAuC6B,YAAvC,CAAjB;;AAEA,QAAMG,OAAO,GAAGnC,CAAC,CAAC2B,WAAD,CAAD,CAAeT,IAAf,CAAoB,0BAApB,EAAgDkB,IAAhD,GAAuD,CAAvD,EAA0DC,UAA1E;;AACAF,IAAAA,OAAO,CAACG,OAAR,CAAgBN,YAAhB;;AAEA,QAAMO,OAAO,GAAGvC,CAAC,CAAC2B,WAAD,CAAD,CAAeT,IAAf,CAAoB,mBAApB,EAAyCkB,IAAzC,GAAgD,CAAhD,EAAmDC,UAAnE;;AACAE,IAAAA,OAAO,CAACD,OAAR,CAAgBN,YAAhB;AACD,GAjFoB;AAmFrB1B,EAAAA,oBAnFqB,gCAmFAF,CAnFA,EAmFGoC,IAnFH,EAmFS;AAC5B,QAAMC,IAAI,GAAGzC,CAAC,CAACwC,IAAD,CAAD,CAAQE,IAAR,CAAa,MAAb,CAAb;AACA,QAAMC,IAAI,GAAG3C,CAAC,CAACwC,IAAD,CAAD,CAAQE,IAAR,CAAa,QAAb,CAAb;;AAEA,QAAME,cAAc,GAAG,SAAjBA,cAAiB,GAAM;AAC3B5C,MAAAA,CAAC,CAAC6C,IAAF,CAAO;AACLC,QAAAA,GAAG,0BAAmBL,IAAnB,CADE;AAELM,QAAAA,IAAI,EAAE;AAFD,OAAP;AAID,KALD;;AAOA,QAAMC,YAAY,GAAI,CAAE;AAAED,MAAAA,IAAI,EAAE,QAAR;AAAkB3B,MAAAA,IAAI,EAAE6B,IAAI,CAACC,CAAL,CAAO,aAAP,CAAxB;AAA+CC,MAAAA,QAAQ,EAAEP;AAAzD,KAAF,EAA6E;AAAEG,MAAAA,IAAI,EAAE;AAAR,KAA7E,CAAtB;AACA,QAAMK,UAAU,GAAGH,IAAI,CAACC,CAAL,CAAO,yBAAP,EAAkC;AAAEP,MAAAA,IAAI,EAAJA;AAAF,KAAlC,CAAnB;AACA,QAAMU,QAAQ,GAAGJ,IAAI,CAACC,CAAL,CAAO,6CAAP,EAAsD;AAAEP,MAAAA,IAAI,EAAJA;AAAF,KAAtD,CAAjB;AACAW,IAAAA,KAAK,CAACC,SAAN,CAAgBH,UAAhB,EAA4BC,QAA5B,EAAsCL,YAAtC,EAAoD,SAApD;AACD,GAlGoB;AAoGrBzC,EAAAA,oBApGqB,gCAoGAH,CApGA,EAoGGoC,IApGH,EAoGS;AAC5BxC,IAAAA,CAAC,CAACwC,IAAD,CAAD,CAAQgB,OAAR,CAAgB,4BAAhB,EAA8CC,MAA9C;AACD,GAtGoB;AAwGrB5C,EAAAA,eAxGqB,6BAwGH;AAChBb,IAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuB0D,IAAvB,CAA4B,YAAW;AACrC,UAAMC,MAAM,GAAG3D,CAAC,CAAC,IAAD,CAAD,CAAQ2D,MAAR,EAAf;AACA,UAAMC,IAAI,GAAG5D,CAAC,CAAC,IAAD,CAAD,CAAQmB,GAAR,EAAb;AACAlC,MAAAA,SAAS,CAAC,IAAD,CAAT,CAAgB4E,OAAhB;AACA7D,MAAAA,CAAC,CAAC2D,MAAD,CAAD,CAAUzC,IAAV,CAAe,mBAAf,EAAoCC,GAApC,CAAwCyC,IAAxC;AACD,KALD;AAOA5D,IAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuB0D,IAAvB,CAA4B,YAAW;AACrC,UAAMC,MAAM,GAAG3D,CAAC,CAAC,IAAD,CAAD,CAAQ2D,MAAR,EAAf;AACA,UAAMG,IAAI,GAAG9D,CAAC,CAAC,IAAD,CAAD,CAAQmB,GAAR,EAAb;AACAlC,MAAAA,SAAS,CAAC,IAAD,CAAT,CAAgB4E,OAAhB;AACA7D,MAAAA,CAAC,CAAC2D,MAAD,CAAD,CAAUzC,IAAV,CAAe,mBAAf,EAAoCC,GAApC,CAAwC2C,IAAxC;AACD,KALD;AAMD,GAtHoB;AAwHrBlD,EAAAA,cAxHqB,4BAwHJ;AACfZ,IAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuB0D,IAAvB,CAA4B,YAAW;AACrC,UAAME,IAAI,GAAG5D,CAAC,CAAC,IAAD,CAAD,CAAQmB,GAAR,EAAb;AACA,UAAMgB,OAAO,GAAGlD,SAAS,CAAC,IAAD,EAAOC,QAAP,CAAzB;AACAiD,MAAAA,OAAO,CAACG,OAAR,CAAgBsB,IAAhB,EAAsB1E,QAAQ,CAACG,UAA/B;AACD,KAJD;AAMAW,IAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuB0D,IAAvB,CAA4B,YAAW;AACrC,UAAMI,IAAI,GAAG9D,CAAC,CAAC,IAAD,CAAD,CAAQmB,GAAR,EAAb;AACA,UAAMoB,OAAO,GAAGtD,SAAS,CAAC,IAAD,EAAOO,QAAP,CAAzB;AACA+C,MAAAA,OAAO,CAACD,OAAR,CAAgBwB,IAAhB,EAAsBtE,QAAQ,CAACH,UAA/B;AACD,KAJD;AAKD,GApIoB;AAsIrBmB,EAAAA,qBAtIqB,iCAsICJ,CAtID,EAsII;AACvBA,IAAAA,CAAC,CAACU,cAAF;AAEAd,IAAAA,CAAC,CAAC,0BAAD,CAAD,CAA8BoB,IAA9B,CAAmC,EAAnC;AACApB,IAAAA,CAAC,CAAC,gCAAD,CAAD,CAAoCoB,IAApC,CAAyC,EAAzC,EAA6C2C,IAA7C;AAEA,QAAMC,WAAW,GAAGhE,CAAC,CAAC,cAAD,CAAD,CAAkBmB,GAAlB,EAApB;;AAEA,QAAI,CAAC6C,WAAL,EAAkB;AAChBhE,MAAAA,CAAC,CAAC,gCAAD,CAAD,CAAoCoB,IAApC,CAAyC6B,IAAI,CAACC,CAAL,CAAO,iDAAP,CAAzC,EAAoGe,IAApG;AACA;AACD;;AAED,QAAID,WAAW,CAAC7D,MAAZ,GAAqB,GAAzB,EAA8B;AAC5BH,MAAAA,CAAC,CAAC,gCAAD,CAAD,CAAoCoB,IAApC,CAAyC6B,IAAI,CAACC,CAAL,CAAO,iDAAP,CAAzC,EAAoGe,IAApG;AACA;AACD;;AAED,QAAMC,KAAK,GAAGlE,CAAC,CAAC,4BAAD,CAAf;AAEA,QAAImE,QAAQ,GAAG,EAAf;;AApBuB,+CAsBJD,KAtBI;AAAA;;AAAA;AAsBvB,0DAA0B;AAAA,YAAfE,IAAe;AACxB,YAAMC,KAAK,GAAGvE,cAAc,CAACiC,mBAAf,CAAmCqC,IAAnC,CAAd;;AAEA,YAAI,CAACC,KAAL,EAAY;AACVrE,UAAAA,CAAC,CAACoE,IAAD,CAAD,CAAQlD,IAAR,CAAa,0BAAb,EAAyCE,IAAzC,CAA8C6B,IAAI,CAACC,CAAL,CAAO,gCAAP,CAA9C;AACA;AACD;;AAED,YAAIlE,MAAM,GAAGsF,OAAT,CAAiBD,KAAK,CAAC,CAAD,CAAtB,CAAJ,EAAgC;AAC9BrE,UAAAA,CAAC,CAACoE,IAAD,CAAD,CAAQlD,IAAR,CAAa,0BAAb,EAAyCE,IAAzC,CAA8C6B,IAAI,CAACC,CAAL,CAAO,6CAAP,CAA9C;AACA;AACD;;AAEDiB,QAAAA,QAAQ,GAAG,GAAGI,MAAH,CAAUJ,QAAV,EAAoBE,KAApB,CAAX;AACD;AApCsB;AAAA;AAAA;AAAA;AAAA;;AAsCvB,QAAIF,QAAQ,CAAChE,MAAT,IAAmB,CAAvB,EAA0B;AACxBH,MAAAA,CAAC,CAAC,0BAAD,CAAD,CAA8BgB,KAA9B,GAAsCI,IAAtC,CAA2C6B,IAAI,CAACC,CAAL,CAAO,gCAAP,CAA3C;AACA,aAAO,KAAP;AACD;;AAED,QAAIpD,cAAc,CAAC0E,cAAf,CAA8BL,QAA9B,CAAJ,EAA6C;AAC3CnE,MAAAA,CAAC,CAAC,0BAAD,CAAD,CAA8BgB,KAA9B,GAAsCI,IAAtC,CAA2C6B,IAAI,CAACC,CAAL,CAAO,6CAAP,CAA3C;AACA,aAAO,KAAP;AACD;;AAEDlD,IAAAA,CAAC,CAACyE,IAAF,CAAO,eAAP,EAAwB;AAAEC,MAAAA,iBAAiB,EAAEP,QAArB;AAA+BH,MAAAA,WAAW,EAAXA;AAA/B,KAAxB;AACA,WAAO,KAAP;AACD,GAxLoB;AA0LrBjC,EAAAA,mBA1LqB,+BA0LDhB,QA1LC,EA0LS;AAC5B,QAAMsD,KAAK,GAAG,EAAd;AAEA,QAAMT,IAAI,GAAG5D,CAAC,CAACe,QAAD,CAAD,CAAYG,IAAZ,CAAiB,mBAAjB,EAAsCC,GAAtC,EAAb;AACA,QAAM2C,IAAI,GAAG9D,CAAC,CAACe,QAAD,CAAD,CAAYG,IAAZ,CAAiB,mBAAjB,EAAsCC,GAAtC,EAAb;AACA,QAAMhB,MAAM,GAAGH,CAAC,CAACe,QAAD,CAAD,CAAYG,IAAZ,CAAiB,qBAAjB,EAAwCC,GAAxC,EAAf;;AAEA,QAAI,CAACyC,IAAD,IAAS,CAACE,IAAV,IAAkB,CAAC3D,MAAvB,EAA+B;AAC7B,aAAO,IAAP;AACD;;AAED,QAAMwE,eAAe,GAAG1F,SAAS,CAAC2F,SAAV,WAAuBhB,IAAvB,cAA+BE,IAA/B,aAA0C5E,QAAQ,CAACG,UAAnD,cAAiEG,QAAQ,CAACH,UAA1E,EAAxB;AAEAgF,IAAAA,KAAK,CAACQ,IAAN,CAAWF,eAAX;AACA,QAAIG,aAAa,GAAGhF,cAAc,CAACoC,eAAf,CAA+B/B,MAA/B,EAAuCwE,eAAvC,CAApB;AAEAN,IAAAA,KAAK,CAACQ,IAAN,CAAWC,aAAX;AAEA,WAAOT,KAAP;AACD,GA7MoB;AA+MrBnC,EAAAA,eA/MqB,2BA+ML/B,MA/MK,EA+MGyD,IA/MH,EA+MS;AAC5B,QAAIkB,aAAa,GAAG,IAApB;;AACA,QAAI3E,MAAM,IAAI,KAAd,EAAqB;AACnB2E,MAAAA,aAAa,GAAG9F,MAAM,CAAC4E,IAAD,CAAN,CAAamB,GAAb,CAAiB,EAAjB,EAAqB,SAArB,EAAgCC,MAAhC,EAAhB;AACD,KAFD,MAEO,IAAI7E,MAAM,IAAI,KAAd,EAAqB;AAC1B2E,MAAAA,aAAa,GAAG9F,MAAM,CAAC4E,IAAD,CAAN,CAAamB,GAAb,CAAiB,EAAjB,EAAqB,SAArB,EAAgCC,MAAhC,EAAhB;AACD,KAFM,MAEA,IAAI7E,MAAM,IAAI,KAAd,EAAqB;AAC1B2E,MAAAA,aAAa,GAAG9F,MAAM,CAAC4E,IAAD,CAAN,CAAamB,GAAb,CAAiB,EAAjB,EAAqB,SAArB,EAAgCC,MAAhC,EAAhB;AACD;;AACD,WAAOF,aAAP;AACD,GAzNoB;AA2NrBN,EAAAA,cA3NqB,0BA2NNH,KA3NM,EA2NC;AACpB,QAAIA,KAAK,CAAClE,MAAN,GAAe,CAAf,KAAqB,CAAzB,EAA4B;AAC1B,aAAO,IAAP;AACD;;AAED,SAAK,IAAI8E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGZ,KAAK,CAAClE,MAAN,GAAe,CAAnC,EAAsC8E,CAAC,IAAI,CAA3C,EAA8C;AAC5C,WAAK,IAAIC,CAAC,GAAGD,CAAC,GAAG,CAAjB,EAAoBC,CAAC,GAAGb,KAAK,CAAClE,MAA9B,EAAsC+E,CAAC,IAAI,CAA3C,EAA8C;AAC5C,YAAIpF,cAAc,CAACqF,iBAAf,CAAiCd,KAAK,CAACY,CAAD,CAAtC,EAA2CZ,KAAK,CAACY,CAAC,GAAC,CAAH,CAAhD,EAAuDZ,KAAK,CAACa,CAAD,CAA5D,EAAiEb,KAAK,CAACa,CAAC,GAAC,CAAH,CAAtE,CAAJ,EAAkF;AAChF,iBAAO,IAAP;AACD;AACF;AACF;;AACD,WAAO,KAAP;AACD,GAxOoB;AA0OrBC,EAAAA,iBA1OqB,6BA0OHC,OA1OG,EA0OMC,KA1ON,EA0OaC,OA1Ob,EA0OsBC,KA1OtB,EA0O6B;AAChD,QAAIH,OAAO,GAAGE,OAAV,IAAsBA,OAAO,GAAGD,KAApC,EAA2C,OAAO,IAAP,CADK,CACQ;;AACxD,QAAID,OAAO,GAAGG,KAAV,IAAsBA,KAAK,GAAKF,KAApC,EAA2C,OAAO,IAAP,CAFK,CAEQ;;AACxD,QAAIC,OAAO,GAAGF,OAAV,IAAsBC,KAAK,GAAKE,KAApC,EAA2C,OAAO,IAAP,CAHK,CAGQ;;AACxD,WAAO,KAAP;AACD,GA/OoB;AAiPrB5E,EAAAA,YAjPqB,wBAiPRP,CAjPQ,EAiPLoC,IAjPK,EAiPC;AACpB,QAAMgD,WAAW,GAAGC,IAAI,CAACC,KAAL,CAAW1F,CAAC,CAACwC,IAAD,CAAD,CAAQE,IAAR,CAAa,eAAb,CAAX,CAApB;;AAEA,QAAI8C,WAAW,IAAIA,WAAW,CAACG,IAA/B,EAAqC;AACnC7F,MAAAA,cAAc,CAAC8F,iBAAf,CAAiCpD,IAAjC;AACD,KAFD,MAEO;AACL1C,MAAAA,cAAc,CAAC+F,gBAAf,CAAgCrD,IAAhC;AACD;AACF,GAzPoB;AA2PrBoD,EAAAA,iBA3PqB,6BA2PHpD,IA3PG,EA2PG;AACtB,QAAMC,IAAI,GAAGzC,CAAC,CAACwC,IAAD,CAAD,CAAQE,IAAR,CAAa,MAAb,CAAb;AACA,QAAMC,IAAI,GAAG3C,CAAC,CAACwC,IAAD,CAAD,CAAQE,IAAR,CAAa,QAAb,CAAb;AACA,QAAM8C,WAAW,GAAGC,IAAI,CAACC,KAAL,CAAW1F,CAAC,CAACwC,IAAD,CAAD,CAAQE,IAAR,CAAa,eAAb,CAAX,CAApB;AAEA,QAAMU,UAAU,GAAGH,IAAI,CAACC,CAAL,CAAO,kBAAP,EAA2B;AAAEP,MAAAA,IAAI,EAAJA;AAAF,KAA3B,CAAnB;AACA,QAAMU,QAAQ,GAAGJ,IAAI,CAACC,CAAL,CAAO,sBAAP,EAA+B;AAAE4C,MAAAA,gBAAgB,EAAEN,WAAW,CAACG,IAAhC;AAAsCI,MAAAA,iBAAiB,EAAEP,WAAW,CAACQ;AAArE,KAA/B,CAAjB;AAEA1C,IAAAA,KAAK,CAACC,SAAN,CAAgBH,UAAhB,EAA4BC,QAA5B,EAAsC,CAAE;AAAEN,MAAAA,IAAI,EAAE,QAAR;AAAkB3B,MAAAA,IAAI,EAAE;AAAxB,KAAF,CAAtC,EAA6E,SAA7E;AACD,GApQoB;AAsQrByE,EAAAA,gBAtQqB,4BAsQJrD,IAtQI,EAsQE;AACrB,QAAMC,IAAI,GAAGzC,CAAC,CAACwC,IAAD,CAAD,CAAQE,IAAR,CAAa,MAAb,CAAb;AACA,QAAMC,IAAI,GAAG3C,CAAC,CAACwC,IAAD,CAAD,CAAQE,IAAR,CAAa,QAAb,CAAb;AACA,QAAMuD,UAAU,GAAGR,IAAI,CAACC,KAAL,CAAW1F,CAAC,CAACwC,IAAD,CAAD,CAAQE,IAAR,CAAa,cAAb,CAAX,CAAnB;;AAEA,QAAMwD,cAAc,GAAG,SAAjBA,cAAiB,GAAM;AAC3B,UAAMC,cAAc,GAAGnG,CAAC,CAAC,oCAAD,CAAD,CAAwCmB,GAAxC,EAAvB;;AAEA,UAAI,CAACgF,cAAL,EAAqB;AACnBC,QAAAA,KAAK,CAACnD,IAAI,CAACC,CAAL,CAAO,4BAAP,CAAD,CAAL;AACA;AACD;;AAEDlD,MAAAA,CAAC,CAAC6C,IAAF,CAAO;AACLC,QAAAA,GAAG,0BAAmBL,IAAnB,sCAAmD0D,cAAnD,CADE;AAELpD,QAAAA,IAAI,EAAE;AAFD,OAAP;AAID,KAZD;;AAcA,QAAMH,cAAc,GAAG,SAAjBA,cAAiB,GAAM;AAC3B5C,MAAAA,CAAC,CAAC6C,IAAF,CAAO;AACLC,QAAAA,GAAG,0BAAmBL,IAAnB,CADE;AAELM,QAAAA,IAAI,EAAE;AAFD,OAAP;AAID,KALD;;AAOA,QAAMC,YAAY,GAAI,CAAE;AAAED,MAAAA,IAAI,EAAE,QAAR;AAAkB3B,MAAAA,IAAI,EAAE6B,IAAI,CAACC,CAAL,CAAO,aAAP,CAAxB;AAA+CC,MAAAA,QAAQ,EAAEP;AAAzD,KAAF,EAA6E;AAAEG,MAAAA,IAAI,EAAE;AAAR,KAA7E,CAAtB;AACA,QAAIsD,aAAa,GAAG,EAApB;;AAEA,QAAIJ,UAAU,CAAC9F,MAAX,GAAoB,CAAxB,EAA2B;AACzBkG,MAAAA,aAAa,IAAIpD,IAAI,CAACC,CAAL,CAAO,iDAAP,CAAjB;;AADyB,kDAGD+C,UAHC;AAAA;;AAAA;AAGzB,+DAAoC;AAAA,cAAzBK,SAAyB;AAClC,cAAIC,YAAY,GAAG,EAAnB;;AADkC,sDAEZD,SAAS,CAACE,QAFE;AAAA;;AAAA;AAElC,mEAA0C;AAAA,kBAA/BC,OAA+B;AACxCF,cAAAA,YAAY,+MAG4BE,OAAO,CAACC,EAHpC,4DAGmFD,OAAO,CAACd,IAH3F,mDAAZ;AAMD;AATiC;AAAA;AAAA;AAAA;AAAA;;AAWlCU,UAAAA,aAAa,4TAMmCC,SAAS,CAACI,EAN7C,4KAOiBJ,SAAS,CAACI,EAP3B,oFAQGJ,SAAS,CAACX,IARb,2GAYHY,YAZG,uHAkBPtD,IAAI,CAACC,CAAL,CAAO,oDAAP,CAlBO,iCAAb;AAqBD;AAnCwB;AAAA;AAAA;AAAA;AAAA;;AAqCzBF,MAAAA,YAAY,CAAC6B,IAAb,CAAmB;AAAE9B,QAAAA,IAAI,EAAE,QAAR;AAAkB3B,QAAAA,IAAI,EAAE6B,IAAI,CAACC,CAAL,CAAO,QAAP,CAAxB;AAA0CC,QAAAA,QAAQ,EAAE+C;AAApD,OAAnB;AACD,KAtCD,MAsCO;AACLG,MAAAA,aAAa,GAAGpD,IAAI,CAACC,CAAL,CAAO,wBAAP,CAAhB;AACD;;AAED,QAAME,UAAU,GAAGH,IAAI,CAACC,CAAL,CAAO,kBAAP,EAA2B;AAAEP,MAAAA,IAAI,EAAJA;AAAF,KAA3B,CAAnB;AACA,QAAMU,QAAQ,qBACVJ,IAAI,CAACC,CAAL,CAAOyD,uBAAP,EAAgC;AAAEhE,MAAAA,IAAI,EAAJA;AAAF,KAAhC,CADU,6CAIV0D,aAJU,WAAd;AAOA/C,IAAAA,KAAK,CAACC,SAAN,CAAgBH,UAAhB,EAA4BC,QAA5B,EAAsCL,YAAtC,EAAoD,SAApD;AACD;AAtVoB,CAAvB;AA0VA,eAAelD,cAAf","sourcesContent":["import moment from 'moment';\nimport flatpickr from 'flatpickr';\n\nconst dateOpts = {\n  altInput: true,\n  altFormat: 'F j, Y',\n  dateFormat: 'Y-m-d',\n  minDate: new Date(),\n};\n\nconst timeOpts = {\n  enableTime: true,\n  noCalendar: true,\n  dateFormat: \"H:i\",\n  defaultHour: 10,\n  defaultMinute: 0,\n  minuteIncrement: 10,\n};\n\nconst OfficeHourForm = {\n  initialize() {\n    $(document).on('turbolinks:load', () => {\n      if ($('.office-hour-form').length > 0) {\n        $('body').on('click', '.add-office-hour-slot', function (e) {\n          OfficeHourForm.addOfficeHourSlot(e);\n        });\n\n        $('body').on('click', '.delete-oh-slot', function (e) {\n          OfficeHourForm.deleteOfficeHourSlot(e, this);\n        });\n\n        $('body').on('click', '.remove-office-hour-slot', function (e) {\n          OfficeHourForm.removeOfficeHourSlot(e, this);\n        });\n\n        $('body').on('click', '.create-office-hour-slots', function (e) {\n          OfficeHourForm.createOfficeHourSlots(e);\n        });\n\n        $('body').on('click', '.cancel-office-hour-slots', function (e) {\n          window.location = '/office_hours';\n        });\n\n        $('body').on('click', '.oh-edit-action', function (e) {\n          OfficeHourForm.showOHAction(e, this);\n        });\n\n        OfficeHourForm.setupFlatpickr();\n      }\n\n    }).on('turbolinks:before-cache', function () {\n      if ($('.office-hour-form').length > 0) {\n        OfficeHourForm.removeFlatpickr();\n      }\n    });\n  },\n\n  addOfficeHourSlot(e) {\n    e.preventDefault();\n\n    OfficeHourForm.removeFlatpickr();\n\n    const slotForm = $('.office-hour-form-template').first().clone();\n\n    $(slotForm).find('.office-hour-date').val('');\n    $(slotForm).find('.office-hour-time').val('');\n    $(slotForm).find('.office-hour-slot-errors').text('');\n    $(slotForm).find('.remove-office-hour-slot').removeClass('hidden');\n\n    $(slotForm).addClass('mt-6');\n    $('.office-hour-form').append(slotForm);\n\n    OfficeHourForm.setupFlatpickr();\n\n    // Try to be smart about picking the next time.\n    OfficeHourForm.guessNextSlot();\n\n    return false;\n  },\n\n  guessNextSlot() {\n    const allSlotForms = $('.office-hour-form-template').toArray();\n    const newSlotForm = allSlotForms.pop();\n    const lastSlotForm = allSlotForms.pop();\n\n    const length = $(newSlotForm).find('.office-hour-length').val();\n\n    const lastSlotDates = OfficeHourForm.slotStartAndEndDate(lastSlotForm);\n    if (!lastSlotDates) {\n      return;\n    }\n\n    let newStartDate = lastSlotDates[1];\n    let newEndDate = OfficeHourForm.addLengthToDate(length, newStartDate);\n\n    const dateObj = $(newSlotForm).find('.office-hour-date:hidden').last()[0]._flatpickr;\n    dateObj.setDate(newStartDate);\n\n    const timeObj = $(newSlotForm).find('.office-hour-time').last()[0]._flatpickr;\n    timeObj.setDate(newStartDate);\n  },\n\n  deleteOfficeHourSlot(e, that) {\n    const OHId = $(that).attr('x-id');\n    const when = $(that).attr('x-when');\n\n    const deleteCallback = () => {\n      $.ajax({\n        url: `/office_hours/${OHId}`,\n        type: 'DELETE',\n      });\n    }\n\n    const modalActions =  [ { type: 'danger', text: I18n.t('delete_slot'), callback: deleteCallback }, { type: 'cancel' } ];\n    const headerHTML = I18n.t('delete_when_office_hour', { when });\n    const bodyHTML = I18n.t('are_you_sure_you_want_to_delete_office_hour', { when });\n    Covid.showModal(headerHTML, bodyHTML, modalActions, 'warning');\n  },\n\n  removeOfficeHourSlot(e, that) {\n    $(that).parents('.office-hour-form-template').remove();\n  },\n\n  removeFlatpickr() {\n    $('.office-hour-date').each(function() {\n      const parent = $(this).parent();\n      const date = $(this).val();\n      flatpickr(this).destroy();\n      $(parent).find('.office-hour-date').val(date);\n    });\n\n    $('.office-hour-time').each(function() {\n      const parent = $(this).parent();\n      const time = $(this).val();\n      flatpickr(this).destroy();\n      $(parent).find('.office-hour-time').val(time);\n    });\n  },\n\n  setupFlatpickr() {\n    $('.office-hour-date').each(function() {\n      const date = $(this).val();\n      const dateObj = flatpickr(this, dateOpts);\n      dateObj.setDate(date, dateOpts.dateFormat);\n    });\n\n    $('.office-hour-time').each(function() {\n      const time = $(this).val();\n      const timeObj = flatpickr(this, timeOpts);\n      timeObj.setDate(time, timeOpts.dateFormat);\n    });\n  },\n\n  createOfficeHourSlots(e) {\n    e.preventDefault();\n\n    $('.office-hour-slot-errors').text('');\n    $('.office-hour-description-error').text('').hide();\n\n    const description = $('#description').val();\n\n    if (!description) {\n      $('.office-hour-description-error').text(I18n.t('we_re_sorry_can_you_please_add_a_description_oh')).show();\n      return;\n    }\n\n    if (description.length > 160) {\n      $('.office-hour-description-error').text(I18n.t('we_re_sorry_you_can_enter_a_maximum_of_160_char')).show();\n      return;\n    }\n\n    const slots = $('.office-hour-form-template');\n\n    let allDates = [];\n\n    for (const slot of slots) {\n      const dates = OfficeHourForm.slotStartAndEndDate(slot);\n\n      if (!dates) {\n        $(slot).find('.office-hour-slot-errors').text(I18n.t('please_enter_a_date_and_a_time'));\n        continue;\n      }\n\n      if (moment().isAfter(dates[0])) {\n        $(slot).find('.office-hour-slot-errors').text(I18n.t('oops_it_seems_like_this_slot_is_in_the_past'));\n        continue;\n      }\n\n      allDates = [].concat(allDates, dates);\n    }\n\n    if (allDates.length == 0) {\n      $('.office-hour-slot-errors').first().text(I18n.t('please_enter_at_least_one_slot'));\n      return false;\n    }\n\n    if (OfficeHourForm.doDatesOverlap(allDates)) {\n      $('.office-hour-slot-errors').first().text(I18n.t('we_re_sorry_it_seems_like_the_dates_overlap'));\n      return false;\n    }\n\n    $.post('/office_hours', { office_hour_dates: allDates, description });\n    return false;\n  },\n\n  slotStartAndEndDate(slotForm) {\n    const dates = [];\n\n    const date = $(slotForm).find('.office-hour-date').val();\n    const time = $(slotForm).find('.office-hour-time').val();\n    const length = $(slotForm).find('.office-hour-length').val();\n\n    if (!date || !time || !length) {\n      return null;\n    }\n\n    const parsedStartDate = flatpickr.parseDate(`${date} ${time}`, `${dateOpts.dateFormat} ${timeOpts.dateFormat}`);\n\n    dates.push(parsedStartDate);\n    let parsedEndDate = OfficeHourForm.addLengthToDate(length, parsedStartDate);\n\n    dates.push(parsedEndDate);\n\n    return dates;\n  },\n\n  addLengthToDate(length, date) {\n    let parsedEndDate = null;\n    if (length == '10m') {\n      parsedEndDate = moment(date).add(10, 'minutes').toDate();\n    } else if (length == '20m') {\n      parsedEndDate = moment(date).add(20, 'minutes').toDate();\n    } else if (length == '30m') {\n      parsedEndDate = moment(date).add(30, 'minutes').toDate();\n    }\n    return parsedEndDate;\n  },\n\n  doDatesOverlap(dates) {\n    if (dates.length % 2 !== 0) {\n      return true;\n    }\n\n    for (let i = 0; i < dates.length - 2; i += 2) {\n      for (let j = i + 2; j < dates.length; j += 2) {\n        if (OfficeHourForm.dateRangeOverlaps(dates[i], dates[i+1], dates[j], dates[j+1])) {\n          return true;\n        }\n      }\n    }\n    return false;\n  },\n\n  dateRangeOverlaps(a_start, a_end, b_start, b_end) {\n    if (a_start < b_start  && b_start < a_end) return true; // b starts in a\n    if (a_start < b_end    && b_end   < a_end) return true; // b ends in a\n    if (b_start < a_start  && a_end   < b_end) return true; // a in b\n    return false;\n  },\n\n  showOHAction(e, that) {\n    const participant = JSON.parse($(that).attr('x-participant'));\n\n    if (participant && participant.name) {\n      OfficeHourForm.showOHParticipant(that);\n    } else {\n      OfficeHourForm.showOHVolunteers(that);\n    }\n  },\n\n  showOHParticipant(that) {\n    const OHId = $(that).attr('x-id');\n    const when = $(that).attr('x-when');\n    const participant = JSON.parse($(that).attr('x-participant'));\n\n    const headerHTML = I18n.t('when_office_hour', { when });\n    const bodyHTML = I18n.t('you_have_accepted_oh', { participant_name: participant.name, participant_email: participant.email });\n\n    Covid.showModal(headerHTML, bodyHTML, [ { type: 'cancel', text: 'Close' } ], 'warning');\n  },\n\n  showOHVolunteers(that) {\n    const OHId = $(that).attr('x-id');\n    const when = $(that).attr('x-when');\n    const volunteers = JSON.parse($(that).attr('x-volunteers'));\n\n    const acceptCallback = () => {\n      const acceptedUserId = $('input[name=\"applicant_id\"]:checked').val();\n\n      if (!acceptedUserId) {\n        alert(I18n.t('please_choose_an_applicant'));\n        return;\n      }\n\n      $.ajax({\n        url: `/office_hours/${OHId}/accept?accepted_user_id=${acceptedUserId}`,\n        type: 'POST',\n      });\n    }\n\n    const deleteCallback = () => {\n      $.ajax({\n        url: `/office_hours/${OHId}`,\n        type: 'DELETE',\n      });\n    }\n\n    const modalActions =  [ { type: 'danger', text: I18n.t('delete_slot'), callback: deleteCallback }, { type: 'cancel' } ];\n    let volunteerHTML = '';\n\n    if (volunteers.length > 0) {\n      volunteerHTML += I18n.t('below_are_the_people_that_applied_for_this_slot');\n\n      for (const volunteer of volunteers) {\n        let projectsHTML = '';\n        for (const project of volunteer.projects) {\n          projectsHTML += `\n            <div class=\"sm:flex sm:justify-between\">\n              <div class=\"ml-7 flex items-center text-sm leading-5 text-gray-500\">\n                -&nbsp;&nbsp;<a href=\"/projects/${project.id}\" target=\"_blank\" class=\"hover:underline\">${project.name}</a>\n              </div>\n            </div>`;\n        }\n\n        volunteerHTML += `\n          <ul class=\"mt-2\">\n            <li>\n              <div class=\"mb-2\">\n                <div class=\"flex items-center justify-between\">\n                  <div class=\"text-sm leading-5 font-medium text-primary-600 truncate\">\n                    <input name=\"applicant_id\" value=\"${volunteer.id}\" type=\"radio\" class=\"form-radio inline-block mr-2 h-4 w-4 text-primary-600 transition duration-150 ease-in-out\" />\n                    <a href=\"/users/${volunteer.id}\" target=\"_blank\" class=\"hover:underline\">\n                      ${volunteer.name}\n                    </a>\n                  </div>\n                </div>\n                ${projectsHTML}\n              </div>\n            </li>\n          </ul>\n\n          <div class=\"mt-2\">\n            ${I18n.t('once_you_accept_someone_you_ll_both_receive_a_call')}\n          </div>\n        `;\n      }\n\n      modalActions.push( { type: 'submit', text: I18n.t('accept'), callback: acceptCallback });\n    } else {\n      volunteerHTML = I18n.t('nobody_has_applied_yet');\n    }\n\n    const headerHTML = I18n.t('when_office_hour', { when });\n    const bodyHTML = `\n      ${I18n.t(you_have_a_slot_at_when, { when })}\n      <br>\n      <br>\n      ${volunteerHTML}\n    `;\n\n    Covid.showModal(headerHTML, bodyHTML, modalActions, 'warning');\n  },\n\n}\n\nexport default OfficeHourForm;\n"]},"metadata":{},"sourceType":"module"}